<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-select=text">
<title>Intermediate Reading Test ‚Äî CD Version</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600;700&family=JetBrains+Mono:wght@400;500&display=swap');

:root {
  --bg-primary: #0f1923;
  --bg-secondary: #162533;
  --bg-card: #1a2d3f;
  --bg-card-hover: #1f3549;
  --accent: #f0a500;
  --accent-light: #ffd166;
  --accent-glow: rgba(240,165,0,0.15);
  --text-primary: #e8edf2;
  --text-secondary: #94a3b8;
  --text-muted: #5a7184;
  --border: #2a3f55;
  --success: #22c55e;
  --success-bg: rgba(34,197,94,0.1);
  --danger: #ef4444;
  --danger-bg: rgba(239,68,68,0.1);
  --highlight-color: rgba(255,230,0,0.35);
  --radius: 12px;
  --radius-sm: 8px;
  --shadow: 0 4px 24px rgba(0,0,0,0.3);
  --transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
}

* { margin:0; padding:0; box-sizing:border-box; }
html, body { height:100%; overflow:hidden; }
body {
  font-family: 'DM Sans', sans-serif;
  background: var(--bg-primary);
  color: var(--text-primary);
  line-height:1.7;
  -webkit-tap-highlight-color: transparent;
}

/* ============ WELCOME SCREEN ============ */
#welcomeScreen {
  position: fixed; inset:0; z-index:9999;
  display:flex; align-items:center; justify-content:center;
  background: linear-gradient(135deg, #0a0f1a 0%, #0f1923 30%, #1a1040 60%, #0d1b2a 100%);
  overflow:hidden;
}
#welcomeScreen::before {
  content:''; position:absolute; inset:0;
  background:
    radial-gradient(ellipse 600px 600px at 20% 50%, rgba(240,165,0,0.08) 0%, transparent 70%),
    radial-gradient(ellipse 500px 500px at 80% 30%, rgba(99,102,241,0.06) 0%, transparent 70%),
    radial-gradient(ellipse 400px 400px at 50% 80%, rgba(236,72,153,0.05) 0%, transparent 70%);
  animation: auroraShift 12s ease-in-out infinite alternate;
}
@keyframes auroraShift {
  0% { opacity:0.7; transform:scale(1) rotate(0deg); }
  100% { opacity:1; transform:scale(1.05) rotate(1deg); }
}
.welcome-particles {
  position:absolute; inset:0; overflow:hidden; pointer-events:none;
}
.particle {
  position:absolute; border-radius:50%; background:rgba(240,165,0,0.3);
  animation: floatUp linear infinite;
}
@keyframes floatUp {
  0% { transform:translateY(100vh) scale(0); opacity:0; }
  10% { opacity:1; }
  90% { opacity:1; }
  100% { transform:translateY(-10vh) scale(1); opacity:0; }
}

.welcome-card {
  position:relative; z-index:2;
  background: rgba(22,37,51,0.85);
  backdrop-filter: blur(30px);
  border:1px solid rgba(240,165,0,0.15);
  border-radius: 24px;
  padding: 48px 40px;
  max-width: 460px; width:92%;
  box-shadow: 0 25px 80px rgba(0,0,0,0.5), 0 0 60px rgba(240,165,0,0.05);
  animation: cardIn 0.8s cubic-bezier(0.16,1,0.3,1) forwards;
  transform: translateY(30px); opacity:0;
}
@keyframes cardIn {
  to { transform:translateY(0); opacity:1; }
}
.welcome-logo {
  text-align:center; margin-bottom:8px;
}
.welcome-logo .icon-circle {
  width:72px; height:72px; margin:0 auto 16px;
  background: linear-gradient(135deg, var(--accent), #e67e22);
  border-radius:50%; display:flex; align-items:center; justify-content:center;
  box-shadow: 0 8px 32px rgba(240,165,0,0.3);
  font-size:32px;
}
.welcome-logo h1 {
  font-family:'Playfair Display',serif; font-size:26px; font-weight:700;
  background: linear-gradient(135deg, var(--accent-light), var(--accent));
  -webkit-background-clip:text; -webkit-text-fill-color:transparent;
  letter-spacing:0.5px;
}
.welcome-logo p {
  color:var(--text-secondary); font-size:13px; margin-top:4px; letter-spacing:2px; text-transform:uppercase;
}
.welcome-owner {
  text-align:center; color:var(--text-muted); font-size:11px; margin-top:4px; letter-spacing:1.5px; text-transform:uppercase;
}

.input-group { margin-top:28px; }
.input-group label {
  display:block; font-size:13px; font-weight:600; color:var(--text-secondary);
  margin-bottom:8px; letter-spacing:0.5px;
}
.input-group input {
  width:100%; padding:14px 16px;
  background: rgba(15,25,35,0.7);
  border:1.5px solid var(--border);
  border-radius: var(--radius-sm);
  color:var(--text-primary);
  font-family:'DM Sans',sans-serif; font-size:15px;
  transition: var(--transition);
  outline:none;
}
.input-group input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.input-group input::placeholder { color:var(--text-muted); }

.pin-input-row {
  display:flex; gap:10px; justify-content:center; margin-top:8px;
}
.pin-box {
  width:56px; height:64px; text-align:center;
  background: rgba(15,25,35,0.7);
  border:1.5px solid var(--border);
  border-radius: var(--radius-sm);
  color:var(--accent-light); font-family:'JetBrains Mono',monospace;
  font-size:24px; font-weight:500;
  transition: var(--transition);
  outline:none;
}
.pin-box:focus {
  border-color:var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
  transform: translateY(-2px);
}

.welcome-error {
  text-align:center; color:var(--danger); font-size:13px;
  margin-top:12px; min-height:20px;
  animation: shake 0.4s ease;
}
@keyframes shake {
  0%,100% { transform:translateX(0); }
  25% { transform:translateX(-6px); }
  75% { transform:translateX(6px); }
}

.btn-start {
  width:100%; padding:16px; margin-top:24px;
  background: linear-gradient(135deg, var(--accent), #e67e22);
  border:none; border-radius: var(--radius-sm);
  color:#0f1923; font-family:'DM Sans',sans-serif;
  font-size:16px; font-weight:700; letter-spacing:1px; text-transform:uppercase;
  cursor:pointer; transition: var(--transition);
  box-shadow: 0 4px 20px rgba(240,165,0,0.3);
}
.btn-start:hover { transform:translateY(-2px); box-shadow:0 8px 30px rgba(240,165,0,0.4); }
.btn-start:active { transform:translateY(0); }
.btn-start:disabled { opacity:0.4; cursor:not-allowed; transform:none; }

/* ============ PROCTORING OVERLAY ============ */
#proctorOverlay {
  display:none; position:fixed; inset:0; z-index:99999;
  background: rgba(10,15,26,0.97);
  backdrop-filter: blur(20px);
  align-items:center; justify-content:center;
  flex-direction:column;
}
#proctorOverlay.active { display:flex; }
.proctor-card {
  background: var(--bg-card);
  border:1px solid var(--danger);
  border-radius: var(--radius);
  padding:40px; max-width:400px; width:90%; text-align:center;
  box-shadow: 0 0 60px rgba(239,68,68,0.15);
}
.proctor-icon {
  width:64px; height:64px; margin:0 auto 20px;
  background: var(--danger-bg);
  border-radius:50%; display:flex; align-items:center; justify-content:center;
  font-size:28px;
  animation: pulse-ring 1.5s ease infinite;
}
@keyframes pulse-ring {
  0% { box-shadow:0 0 0 0 rgba(239,68,68,0.4); }
  70% { box-shadow:0 0 0 15px rgba(239,68,68,0); }
  100% { box-shadow:0 0 0 0 rgba(239,68,68,0); }
}
.proctor-card h2 { font-family:'Playfair Display',serif; color:var(--danger); margin-bottom:10px; }
.proctor-card p { color:var(--text-secondary); font-size:14px; margin-bottom:20px; }
.proctor-pin-row { display:flex; gap:8px; justify-content:center; margin-bottom:12px; }
.proctor-pin {
  width:50px; height:56px; text-align:center;
  background:rgba(15,25,35,0.7); border:1.5px solid var(--border);
  border-radius:var(--radius-sm); color:var(--accent-light);
  font-family:'JetBrains Mono',monospace; font-size:22px;
  outline:none; transition:var(--transition);
}
.proctor-pin:focus { border-color:var(--accent); box-shadow:0 0 0 3px var(--accent-glow); }
.proctor-error { color:var(--danger); font-size:13px; min-height:18px; margin-bottom:12px; }

/* ============ FULLSCREEN PROMPT ============ */
.fullscreen-prompt {
  position:fixed; inset:0; z-index:99998;
  background:rgba(10,15,26,0.95); backdrop-filter:blur(20px);
  display:none; align-items:center; justify-content:center;
}
.fullscreen-prompt.active { display:flex; }
.fs-card {
  background:var(--bg-card); border:1px solid var(--border);
  border-radius:var(--radius); padding:40px; max-width:380px; width:90%; text-align:center;
}
.fs-card .icon-circle { width:64px;height:64px;margin:0 auto 20px;background:var(--accent-glow);border-radius:50%;display:flex;align-items:center;justify-content:center;font-size:28px; }
.fs-card h2 { font-family:'Playfair Display',serif; margin-bottom:10px; }
.fs-card p { color:var(--text-secondary); font-size:14px; margin-bottom:24px; }

/* ============ MAIN TEST LAYOUT ============ */
#testContainer {
  display:none; height:100vh; flex-direction:column;
  background: var(--bg-primary);
}
#testContainer.active { display:flex; }

.test-header {
  flex-shrink:0;
  background: var(--bg-secondary);
  border-bottom:1px solid var(--border);
  padding:10px 20px;
  display:flex; align-items:center; justify-content:space-between;
  gap:12px;
}
.test-header-left { display:flex; align-items:center; gap:12px; }
.test-title {
  font-family:'Playfair Display',serif; font-size:16px; font-weight:700;
  color:var(--accent-light); white-space:nowrap;
}
.student-name-tag {
  font-size:12px; color:var(--text-secondary);
  background:rgba(240,165,0,0.08); border:1px solid rgba(240,165,0,0.15);
  padding:4px 10px; border-radius:20px;
}

/* Progress circle */
.progress-ring-wrap {
  position:relative; width:44px; height:44px; flex-shrink:0; cursor:default;
}
.progress-ring-wrap svg { transform:rotate(-90deg); }
.progress-track { fill:none; stroke:var(--border); stroke-width:3; }
.progress-fill {
  fill:none; stroke:var(--accent); stroke-width:3;
  stroke-linecap:round; transition: stroke-dashoffset 0.6s ease;
}
.progress-text {
  position:absolute; inset:0; display:flex; align-items:center; justify-content:center;
  font-size:11px; font-weight:700; color:var(--accent-light);
  font-family:'JetBrains Mono',monospace;
}

/* Navigation pills */
.nav-pills {
  display:flex; gap:6px; flex-shrink:0;
}
.nav-pill {
  padding:5px 12px; border-radius:20px;
  font-size:11px; font-weight:600; letter-spacing:0.5px; text-transform:uppercase;
  background:rgba(255,255,255,0.04); border:1px solid var(--border);
  color:var(--text-secondary); cursor:pointer; transition:var(--transition);
  white-space:nowrap;
}
.nav-pill:hover, .nav-pill.active {
  background:var(--accent-glow); border-color:var(--accent); color:var(--accent-light);
}

/* Split pane */
.test-body {
  flex:1; display:flex; overflow:hidden;
  position:relative;
}
.pane {
  flex:1; overflow-y:auto; padding:24px 28px 100px;
  scroll-behavior:smooth;
}
.pane::-webkit-scrollbar { width:6px; }
.pane::-webkit-scrollbar-track { background:transparent; }
.pane::-webkit-scrollbar-thumb { background:var(--border); border-radius:3px; }
.pane::-webkit-scrollbar-thumb:hover { background:var(--text-muted); }

.pane-left {
  border-right:1px solid var(--border);
  background: var(--bg-secondary);
}
.pane-right {
  background: var(--bg-primary);
}

.divider {
  width:4px; background:var(--border); cursor:col-resize;
  flex-shrink:0; position:relative;
  transition: background 0.2s;
}
.divider:hover, .divider.active { background:var(--accent); }
.divider::after {
  content:''; position:absolute; left:-8px; right:-8px; top:0; bottom:0;
}

/* Passage styling */
.passage-header {
  font-family:'Playfair Display',serif; font-size:22px; font-weight:700;
  color:var(--accent-light); margin-bottom:4px;
}
.passage-meta {
  font-size:12px; color:var(--text-muted); margin-bottom:20px;
  letter-spacing:1px; text-transform:uppercase;
}
.passage-email-bar {
  background:rgba(240,165,0,0.06); border:1px solid rgba(240,165,0,0.1);
  border-radius:var(--radius-sm); padding:12px 16px; margin-bottom:20px;
}
.passage-email-bar .field { font-size:13px; color:var(--text-secondary); margin-bottom:4px; }
.passage-email-bar .field span { color:var(--text-primary); font-weight:500; }
.passage-text {
  font-size:15px; line-height:1.85; color:var(--text-primary);
}
.passage-text p { margin-bottom:16px; }
.passage-text .bold-word { font-weight:700; color:var(--accent-light); }

/* Question styling */
.question-section { margin-bottom:36px; }
.section-badge {
  display:inline-block; padding:5px 14px;
  background: linear-gradient(135deg, var(--accent), #e67e22);
  color:#0f1923; font-size:11px; font-weight:700; letter-spacing:1px; text-transform:uppercase;
  border-radius:20px; margin-bottom:16px;
}
.question-block {
  background: var(--bg-card);
  border:1px solid var(--border);
  border-radius: var(--radius);
  padding:20px; margin-bottom:16px;
  transition: var(--transition);
}
.question-block:hover { border-color: rgba(240,165,0,0.2); }
.question-block.answered { border-left:3px solid var(--success); }
.q-number {
  font-family:'JetBrains Mono',monospace; font-size:11px; font-weight:600;
  color:var(--accent); letter-spacing:1px; margin-bottom:6px;
}
.q-text { font-size:14px; font-weight:500; margin-bottom:14px; color:var(--text-primary); }

.option-label {
  display:flex; align-items:flex-start; gap:10px;
  padding:10px 14px; border-radius:var(--radius-sm);
  border:1px solid transparent; cursor:pointer;
  transition: var(--transition); margin-bottom:6px;
  font-size:14px;
}
.option-label:hover { background:rgba(255,255,255,0.03); border-color:var(--border); }
.option-label input { display:none; }
.option-radio {
  width:20px; height:20px; border-radius:50%;
  border:2px solid var(--border); flex-shrink:0; margin-top:1px;
  transition: var(--transition);
  display:flex; align-items:center; justify-content:center;
}
.option-radio::after {
  content:''; width:10px; height:10px; border-radius:50%;
  background:var(--accent); transform:scale(0);
  transition: transform 0.25s cubic-bezier(0.34,1.56,0.64,1);
}
.option-label input:checked ~ .option-radio { border-color:var(--accent); }
.option-label input:checked ~ .option-radio::after { transform:scale(1); }
.option-label input:checked ~ .option-text { color:var(--accent-light); font-weight:500; }
.option-text { color:var(--text-secondary); transition:var(--transition); }

/* TF/NG styling */
.tfng-options {
  display:flex; gap:8px; flex-wrap:wrap;
}
.tfng-btn {
  flex:1; min-width:80px; padding:10px 16px; text-align:center;
  border-radius:var(--radius-sm); border:1.5px solid var(--border);
  background:transparent; color:var(--text-secondary);
  font-family:'DM Sans',sans-serif; font-size:13px; font-weight:600;
  cursor:pointer; transition:var(--transition);
}
.tfng-btn:hover { border-color:rgba(240,165,0,0.3); color:var(--text-primary); }
.tfng-btn.selected {
  background:var(--accent-glow); border-color:var(--accent);
  color:var(--accent-light);
}
.tfng-btn.selected.true-btn { background:var(--success-bg); border-color:var(--success); color:var(--success); }
.tfng-btn.selected.false-btn { background:var(--danger-bg); border-color:var(--danger); color:var(--danger); }
.tfng-btn.selected.ng-btn { background:rgba(99,102,241,0.1); border-color:#6366f1; color:#818cf8; }

/* Footer bar */
.test-footer {
  flex-shrink:0; background:var(--bg-secondary);
  border-top:1px solid var(--border);
  padding:12px 20px; display:flex; align-items:center; justify-content:space-between; gap:12px;
}
.btn {
  padding:10px 20px; border-radius:var(--radius-sm);
  font-family:'DM Sans',sans-serif; font-size:14px; font-weight:600;
  cursor:pointer; transition:var(--transition); border:none;
}
.btn-submit {
  background: linear-gradient(135deg, var(--success), #16a34a);
  color:white;
  box-shadow:0 4px 16px rgba(34,197,94,0.25);
}
.btn-submit:hover { transform:translateY(-1px); box-shadow:0 6px 24px rgba(34,197,94,0.35); }
.btn-copy {
  background:transparent; border:1.5px solid var(--border); color:var(--text-secondary);
}
.btn-copy:hover { border-color:var(--accent); color:var(--accent-light); }

/* Visual feedback toasts */
.toast-container {
  position:fixed; bottom:80px; left:50%; transform:translateX(-50%);
  z-index:99990; display:flex; flex-direction:column; align-items:center; gap:8px;
  pointer-events:none;
}
.toast {
  padding:12px 24px; border-radius:30px;
  font-size:13px; font-weight:600;
  backdrop-filter:blur(20px);
  animation: toastIn 0.4s cubic-bezier(0.16,1,0.3,1) forwards, toastOut 0.3s ease 2.2s forwards;
  pointer-events:auto;
}
.toast-success { background:rgba(34,197,94,0.9); color:white; }
.toast-info { background:rgba(240,165,0,0.9); color:#0f1923; }
.toast-error { background:rgba(239,68,68,0.9); color:white; }
@keyframes toastIn { from { opacity:0;transform:translateY(20px);} to {opacity:1;transform:translateY(0);} }
@keyframes toastOut { to { opacity:0;transform:translateY(-10px);} }

/* Highlight */
.user-highlight { background: var(--highlight-color); border-radius:2px; }

/* Submit overlay */
#submitOverlay {
  display:none; position:fixed; inset:0; z-index:99997;
  background:rgba(10,15,26,0.95); backdrop-filter:blur(20px);
  align-items:center; justify-content:center;
}
#submitOverlay.active { display:flex; }
.submit-card {
  background:var(--bg-card); border:1px solid var(--border);
  border-radius:20px; padding:40px; max-width:420px; width:92%; text-align:center;
}
.submit-icon {
  width:72px; height:72px; margin:0 auto 20px;
  background:var(--success-bg); border-radius:50%;
  display:flex; align-items:center; justify-content:center; font-size:32px;
}
.submit-card h2 { font-family:'Playfair Display',serif; color:var(--success); margin-bottom:8px; }
.submit-card p { color:var(--text-secondary); font-size:14px; margin-bottom:24px; }
.submit-actions { display:flex; gap:10px; flex-wrap:wrap; justify-content:center; }
.btn-pdf {
  background:linear-gradient(135deg,#6366f1,#4f46e5);
  color:white; box-shadow:0 4px 16px rgba(99,102,241,0.25);
}
.btn-pdf:hover { transform:translateY(-1px); }

/* Mobile layout */
@media (max-width:768px) {
  .test-body { flex-direction:column; }
  .pane-left { border-right:none; border-bottom:1px solid var(--border); max-height:45vh; }
  .pane-right { max-height:none; }
  .divider { display:none; }
  .pane { padding:16px 16px 80px; }
  .test-header { padding:8px 12px; flex-wrap:wrap; gap:8px; }
  .test-title { font-size:14px; }
  .nav-pills { overflow-x:auto; flex-wrap:nowrap; -webkit-overflow-scrolling:touch; }
  .nav-pill { font-size:10px; padding:4px 10px; }
  .student-name-tag { font-size:10px; }
  .test-footer { padding:10px 12px; }
  .btn { padding:9px 14px; font-size:13px; }
  .passage-header { font-size:18px; }
  .passage-text { font-size:14px; }
  .question-block { padding:14px; }
  .welcome-card { padding:32px 24px; }
  .pin-box { width:48px; height:56px; font-size:22px; }
  .progress-ring-wrap { width:38px; height:38px; }
  .tfng-options { gap:6px; }
  .tfng-btn { padding:8px 10px; font-size:12px; min-width:60px; }

  /* Mobile pane toggle */
  .mobile-pane-toggle {
    display:flex !important;
  }
}
@media (min-width:769px) {
  .mobile-pane-toggle { display:none !important; }
}

.mobile-pane-toggle {
  display:none;
  gap:4px;
  background:var(--bg-card);
  border-radius:20px;
  padding:3px;
  border:1px solid var(--border);
}
.pane-tab {
  padding:5px 14px; border-radius:18px;
  font-size:11px; font-weight:600;
  background:transparent; border:none;
  color:var(--text-muted); cursor:pointer;
  transition:var(--transition);
}
.pane-tab.active { background:var(--accent-glow); color:var(--accent-light); }

/* Confirm dialog */
.confirm-overlay {
  display:none; position:fixed; inset:0; z-index:99996;
  background:rgba(10,15,26,0.9); backdrop-filter:blur(10px);
  align-items:center; justify-content:center;
}
.confirm-overlay.active { display:flex; }
.confirm-card {
  background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius);
  padding:32px; max-width:360px; width:90%; text-align:center;
}
.confirm-card h3 { font-family:'Playfair Display',serif; margin-bottom:10px; }
.confirm-card p { color:var(--text-secondary); font-size:14px; margin-bottom:20px; }
.confirm-btns { display:flex; gap:10px; justify-content:center; }
.btn-cancel { background:transparent; border:1.5px solid var(--border); color:var(--text-secondary); }
.btn-cancel:hover { border-color:var(--text-muted); }
</style>
</head>
<body>

<!-- WELCOME SCREEN -->
<div id="welcomeScreen">
  <div class="welcome-particles" id="particles"></div>
  <div class="welcome-card">
    <div class="welcome-logo">
      <div class="icon-circle">üìñ</div>
      <h1>Reading Test</h1>
      <p>Intermediate Level ‚Äî CD Version</p>
    </div>
    <div class="welcome-owner">Test Owner: DJAXONGIR TURAYEV</div>

    <div class="input-group">
      <label>Full Name</label>
      <input type="text" id="studentName" placeholder="Enter your full name" autocomplete="off" />
    </div>

    <div class="input-group">
      <label>Access Code</label>
      <div class="pin-input-row">
        <input class="pin-box" type="tel" maxlength="1" id="pin1" inputmode="numeric" autocomplete="off" />
        <input class="pin-box" type="tel" maxlength="1" id="pin2" inputmode="numeric" autocomplete="off" />
        <input class="pin-box" type="tel" maxlength="1" id="pin3" inputmode="numeric" autocomplete="off" />
        <input class="pin-box" type="tel" maxlength="1" id="pin4" inputmode="numeric" autocomplete="off" />
      </div>
    </div>
    <div class="welcome-error" id="welcomeError"></div>
    <button class="btn-start" id="btnStart" disabled>Start Test</button>
  </div>
</div>

<!-- PROCTOR OVERLAY -->
<div id="proctorOverlay">
  <div class="proctor-card">
    <div class="proctor-icon">üîí</div>
    <h2>Test Paused</h2>
    <p>You left the test window. Enter the proctor code to continue.</p>
    <div class="proctor-pin-row">
      <input class="proctor-pin" type="tel" maxlength="1" id="pp1" inputmode="numeric" autocomplete="off" />
      <input class="proctor-pin" type="tel" maxlength="1" id="pp2" inputmode="numeric" autocomplete="off" />
      <input class="proctor-pin" type="tel" maxlength="1" id="pp3" inputmode="numeric" autocomplete="off" />
      <input class="proctor-pin" type="tel" maxlength="1" id="pp4" inputmode="numeric" autocomplete="off" />
    </div>
    <div class="proctor-error" id="proctorError"></div>
    <button class="btn btn-submit" onclick="checkProctorPin()">Unlock</button>
  </div>
</div>

<!-- FULLSCREEN PROMPT -->
<div class="fullscreen-prompt" id="fsPrompt">
  <div class="fs-card">
    <div class="icon-circle">‚õ∂</div>
    <h2>Full Screen Required</h2>
    <p>This test runs in full screen mode for exam integrity.</p>
    <button class="btn btn-submit" onclick="goFullscreen()">Enter Full Screen</button>
  </div>
</div>

<!-- SUBMIT OVERLAY -->
<div id="submitOverlay">
  <div class="submit-card">
    <div class="submit-icon">‚úÖ</div>
    <h2>Test Submitted!</h2>
    <p id="submitMsg">Your answers have been recorded.</p>
    <div class="submit-actions">
      <button class="btn btn-copy" onclick="copyAnswers()">üìã Copy Answers</button>
      <button class="btn btn-pdf" onclick="savePDF()">üìÑ Save as PDF</button>
    </div>
  </div>
</div>

<!-- CONFIRM DIALOG -->
<div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-card">
    <h3>Submit Test?</h3>
    <p id="confirmMsg">Are you sure you want to submit?</p>
    <div class="confirm-btns">
      <button class="btn btn-cancel" onclick="closeConfirm()">Cancel</button>
      <button class="btn btn-submit" onclick="doSubmit()">Submit</button>
    </div>
  </div>
</div>

<!-- TOAST CONTAINER -->
<div class="toast-container" id="toastContainer"></div>

<!-- MAIN TEST -->
<div id="testContainer">
  <div class="test-header">
    <div class="test-header-left">
      <div class="test-title">Reading Test</div>
      <div class="student-name-tag" id="headerName"></div>
      <div class="mobile-pane-toggle" id="paneToggle">
        <button class="pane-tab active" data-pane="passage">üìñ Passage</button>
        <button class="pane-tab" data-pane="questions">‚úèÔ∏è Questions</button>
      </div>
    </div>
    <div style="display:flex;align-items:center;gap:10px;">
      <div class="nav-pills" id="navPills">
        <button class="nav-pill active" data-section="mcq">Q 1‚Äì10</button>
        <button class="nav-pill" data-section="tfng">Q 11‚Äì16</button>
        <button class="nav-pill" data-section="vocab">Q 17‚Äì20</button>
      </div>
      <div class="progress-ring-wrap" title="Progress">
        <svg width="100%" height="100%" viewBox="0 0 44 44">
          <circle class="progress-track" cx="22" cy="22" r="18"/>
          <circle class="progress-fill" id="progressCircle" cx="22" cy="22" r="18"
            stroke-dasharray="113.1" stroke-dashoffset="113.1"/>
        </svg>
        <div class="progress-text" id="progressText">0%</div>
      </div>
    </div>
  </div>

  <div class="test-body">
    <!-- LEFT: Passage -->
    <div class="pane pane-left" id="paneLeft">
      <div class="passage-header">Accommodation</div>
      <div class="passage-meta">Email from Natalie</div>
      <div class="passage-email-bar">
        <div class="field"><strong>To:</strong> <span>Ellie Crest</span></div>
        <div class="field"><strong>Subject:</strong> <span>Surfing Holiday</span></div>
      </div>
      <div class="passage-text" id="passageText">
        <p>Hi Ellie,</p>
        <p>I'm so pleased you can come surfing in August! Paul, Rose and Kevin are coming too, so there will be five of us. We've decided to return to New Sands for a couple of days, because the surf board <span class="bold-word">hire</span> is so cheap there.</p>
        <p>I'm starting to think about accommodation. We won't camp again after last year! I hated staying in a tent in all that rain!</p>
        <p>Kevin wants to hire a caravan. There are some nice ones with 3 bedrooms, showers and cooking <span class="bold-word">facilities</span>. The problem is, none of the caravan parks take short bookings in the summer. The minimum stay is a week. It's a shame because there are several nice parks near the beach.</p>
        <p>There's a hostel for young people in New Sands. It's the cheapest option after camping, and there's a big kitchen and dining room where we can cook. The problem is, accommodation is in <span class="bold-word">dormitories</span> and I don't really want to sleep with strangers.</p>
        <p>There are a few <span class="bold-word">guest houses</span> in New Sands. Some have triple rooms, so we only need to book two rooms. We'll have to book soon if we choose that option, because many guest houses are already full. The hotels in New Sands are too expensive, although I'd love to stay at the Sunrise Pavilion with its large pool!</p>
        <p>The final option is to rent a cottage. I found one. It has three bedrooms ‚Äî a double, a single and a twin, so two of us would have to share a bed! There's a big kitchen diner with a microwave, washing machine and dishwasher. The living room has a TV and DVD player. There's just one bathroom, but there's a separate WC. There's a nice garden too. The problem is, it's 5 miles from the beach.</p>
        <p>Let me know which option you prefer.</p>
        <p>Cheers,<br/>Natalie</p>
      </div>
    </div>

    <!-- DIVIDER -->
    <div class="divider" id="divider"></div>

    <!-- RIGHT: Questions -->
    <div class="pane pane-right" id="paneRight">

      <!-- MCQ Section -->
      <div class="question-section" id="sec-mcq">
        <div class="section-badge">Questions 1‚Äì10 ¬∑ Multiple Choice</div>
        <p style="font-size:13px;color:var(--text-secondary);margin-bottom:20px;">Read the letter about accommodation and choose the correct answer.</p>
      </div>

      <!-- TFNG Section -->
      <div class="question-section" id="sec-tfng">
        <div class="section-badge">Questions 11‚Äì16 ¬∑ True / False / Not Given</div>
      </div>

      <!-- Vocabulary Section -->
      <div class="question-section" id="sec-vocab">
        <div class="section-badge">Questions 17‚Äì20 ¬∑ Vocabulary</div>
        <p style="font-size:13px;color:var(--text-secondary);margin-bottom:20px;">Choose the correct meaning of the word from the text.</p>
      </div>

    </div>
  </div>

  <div class="test-footer">
    <div style="display:flex;gap:8px;flex-wrap:wrap;">
      <button class="btn btn-submit" onclick="confirmSubmit()">‚úì Submit Answers</button>
      <button class="btn btn-copy" onclick="copyAnswers()">üìã Copy Answers</button>
    </div>
    <div style="font-size:11px;color:var(--text-muted);">Owner: DJAXONGIR TURAYEV</div>
  </div>
</div>

<script>
// ============ DATA ============
const MCQ = [
  {n:1, q:"The friends want to stay in New Sands for ...", opts:["A week","A week and a half","Less than one week"]},
  {n:2, q:"Last year the friends stayed in a ...", opts:["Tent","Caravan","Youth hostel"]},
  {n:3, q:"Last year the students had problems with ...", opts:["The weather","The transport","Their surf boards"]},
  {n:4, q:"The problem with the caravan park is that ...", opts:["All the caravans are fully booked","There are not enough beds for everyone","Caravans are only available for at least one week"]},
  {n:5, q:"Natalie doesn't want to stay in the youth hostel because ...", opts:["It's too expensive","She can't cook her own meals","She doesn't want to share a room with people she doesn't know"]},
  {n:6, q:"The guest houses ...", opts:["Are fully booked","Still have some free rooms","Don't have rooms for three people"]},
  {n:7, q:"The Sunrise Pavilion ...", opts:["Costs too much","Has no rooms available","Does not have a swimming pool"]},
  {n:8, q:"The cottage that Natalie found ...", opts:["Doesn't have a toilet","Has one room with two beds","Doesn't have a room with only one bed"]},
  {n:9, q:"In the cottage the ...", opts:["Bathroom is outside","Shower and the WC are in the same room","Cooking area and dining area in the same room"]},
  {n:10, q:"The problem with the cottage is its ...", opts:["Size","Price","Location"]}
];
const TFNG = [
  {n:11, q:"Natalie and her friends are planning a surfing trip in August."},
  {n:12, q:"There will be six people going on the trip."},
  {n:13, q:"Natalie enjoyed camping during their last holiday."},
  {n:14, q:"Caravan parks in New Sands usually require visitors to stay for at least a week in summer."},
  {n:15, q:"Natalie prefers to stay in a dormitory with other people."},
  {n:16, q:"The cottage they are considering is located very close to the beach."}
];
const VOCAB = [
  {n:17, word:"hire", para:"paragraph 1", opts:["To buy something","To rent something for a short time","To repair something"]},
  {n:18, word:"dormitories", para:"paragraph 4", opts:["Private hotel rooms","Large rooms where many people sleep","Small houses for families"]},
  {n:19, word:"guest houses", para:"paragraph 5", opts:["Small hotels or private homes offering accommodation","Luxury apartments","Camping areas"]},
  {n:20, word:"facilities", para:"paragraph 3", opts:["People who work there","Services or equipment provided for use","Rules you must follow"]}
];

let answers = {};
let testStarted = false;
let testSubmitted = false;
let studentNameVal = '';

// ============ PARTICLES ============
(function(){
  const c = document.getElementById('particles');
  for(let i=0;i<30;i++){
    const p = document.createElement('div');
    p.className='particle';
    const s = Math.random()*4+2;
    p.style.cssText = `width:${s}px;height:${s}px;left:${Math.random()*100}%;animation-duration:${Math.random()*8+6}s;animation-delay:${Math.random()*6}s;opacity:${Math.random()*0.5+0.2};`;
    c.appendChild(p);
  }
})();

// ============ PIN INPUTS ============
function setupPinInputs(ids, onComplete){
  ids.forEach((id,i) => {
    const el = document.getElementById(id);
    el.addEventListener('input', e => {
      e.target.value = e.target.value.replace(/\D/g,'').slice(0,1);
      if(e.target.value && i < ids.length-1) document.getElementById(ids[i+1]).focus();
      onComplete();
    });
    el.addEventListener('keydown', e => {
      if(e.key==='Backspace' && !e.target.value && i>0) document.getElementById(ids[i-1]).focus();
    });
  });
}

function getPinValue(ids){ return ids.map(id=>document.getElementById(id).value).join(''); }

const welcomePins = ['pin1','pin2','pin3','pin4'];
const proctorPins = ['pp1','pp2','pp3','pp4'];

setupPinInputs(welcomePins, ()=>{
  const name = document.getElementById('studentName').value.trim();
  const pin = getPinValue(welcomePins);
  document.getElementById('btnStart').disabled = !(name.length>=2 && pin.length===4);
});

document.getElementById('studentName').addEventListener('input', ()=>{
  const name = document.getElementById('studentName').value.trim();
  const pin = getPinValue(welcomePins);
  document.getElementById('btnStart').disabled = !(name.length>=2 && pin.length===4);
});

setupPinInputs(proctorPins, ()=>{});

// ============ START TEST ============
document.getElementById('btnStart').addEventListener('click', ()=>{
  const name = document.getElementById('studentName').value.trim();
  const pin = getPinValue(welcomePins);
  if(pin !== '0521'){
    document.getElementById('welcomeError').textContent = 'Incorrect access code. Try again.';
    welcomePins.forEach(id=>{document.getElementById(id).value='';});
    document.getElementById('pin1').focus();
    return;
  }
  studentNameVal = name;
  document.getElementById('welcomeScreen').style.display='none';
  document.getElementById('headerName').textContent = name;
  buildQuestions();
  testStarted = true;

  // try fullscreen
  tryFullscreen();
});

function tryFullscreen(){
  const el = document.documentElement;
  const rfs = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen;
  if(rfs){
    rfs.call(el).then(()=>{
      document.getElementById('testContainer').classList.add('active');
    }).catch(()=>{
      // If fullscreen fails, just show test
      document.getElementById('testContainer').classList.add('active');
    });
  } else {
    document.getElementById('testContainer').classList.add('active');
  }
}

function goFullscreen(){
  const el = document.documentElement;
  const rfs = el.requestFullscreen || el.webkitRequestFullscreen || el.msRequestFullscreen;
  if(rfs) rfs.call(el);
  document.getElementById('fsPrompt').classList.remove('active');
}

// ============ PROCTORING ============
document.addEventListener('visibilitychange', ()=>{
  if(testStarted && !testSubmitted && document.hidden){
    document.getElementById('proctorOverlay').classList.add('active');
    proctorPins.forEach(id=>{document.getElementById(id).value='';});
  }
});
window.addEventListener('blur', ()=>{
  if(testStarted && !testSubmitted){
    document.getElementById('proctorOverlay').classList.add('active');
    proctorPins.forEach(id=>{document.getElementById(id).value='';});
  }
});

function checkProctorPin(){
  const pin = getPinValue(proctorPins);
  if(pin === '2110'){
    document.getElementById('proctorOverlay').classList.remove('active');
    document.getElementById('proctorError').textContent = '';
    showToast('Test resumed','info');
  } else {
    document.getElementById('proctorError').textContent = 'Incorrect code.';
    proctorPins.forEach(id=>{document.getElementById(id).value='';});
    document.getElementById('pp1').focus();
  }
}

// ============ BUILD QUESTIONS ============
function buildQuestions(){
  const mcqSec = document.getElementById('sec-mcq');
  MCQ.forEach(q => {
    const block = document.createElement('div');
    block.className='question-block';
    block.id='qblock-'+q.n;
    let html = `<div class="q-number">QUESTION ${q.n}</div><div class="q-text">${q.q}</div>`;
    q.opts.forEach((o,i) => {
      const letter = String.fromCharCode(65+i);
      html += `<label class="option-label">
        <input type="radio" name="q${q.n}" value="${letter}" onchange="setAnswer(${q.n},'${letter}')"/>
        <span class="option-radio"></span>
        <span class="option-text">${letter}. ${o}</span>
      </label>`;
    });
    block.innerHTML = html;
    mcqSec.appendChild(block);
  });

  const tfSec = document.getElementById('sec-tfng');
  TFNG.forEach(q => {
    const block = document.createElement('div');
    block.className='question-block';
    block.id='qblock-'+q.n;
    block.innerHTML = `<div class="q-number">QUESTION ${q.n}</div><div class="q-text">${q.q}</div>
      <div class="tfng-options">
        <button class="tfng-btn true-btn" onclick="setTFNG(${q.n},'TRUE',this)">TRUE</button>
        <button class="tfng-btn false-btn" onclick="setTFNG(${q.n},'FALSE',this)">FALSE</button>
        <button class="tfng-btn ng-btn" onclick="setTFNG(${q.n},'NOT GIVEN',this)">NOT GIVEN</button>
      </div>`;
    tfSec.appendChild(block);
  });

  const vocSec = document.getElementById('sec-vocab');
  VOCAB.forEach(q => {
    const block = document.createElement('div');
    block.className='question-block';
    block.id='qblock-'+q.n;
    let html = `<div class="q-number">QUESTION ${q.n}</div><div class="q-text"><strong>${q.word}</strong> (${q.para})</div>`;
    q.opts.forEach((o,i) => {
      const letter = String.fromCharCode(65+i);
      html += `<label class="option-label">
        <input type="radio" name="q${q.n}" value="${letter}" onchange="setAnswer(${q.n},'${letter}')"/>
        <span class="option-radio"></span>
        <span class="option-text">${letter}) ${o}</span>
      </label>`;
    });
    block.innerHTML = html;
    vocSec.appendChild(block);
  });
}

function setAnswer(n, val){
  answers[n] = val;
  document.getElementById('qblock-'+n).classList.add('answered');
  updateProgress();
  showToast(`Question ${n} answered`,'success');
}
function setTFNG(n, val, btn){
  answers[n] = val;
  const block = document.getElementById('qblock-'+n);
  block.classList.add('answered');
  block.querySelectorAll('.tfng-btn').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  updateProgress();
  showToast(`Question ${n} answered`,'success');
}

function updateProgress(){
  const total = 20;
  const done = Object.keys(answers).length;
  const pct = Math.round((done/total)*100);
  const circ = 113.1;
  document.getElementById('progressCircle').style.strokeDashoffset = circ - (circ * done / total);
  document.getElementById('progressText').textContent = pct+'%';
}

// ============ NAVIGATION ============
document.querySelectorAll('.nav-pill').forEach(pill=>{
  pill.addEventListener('click', ()=>{
    document.querySelectorAll('.nav-pill').forEach(p=>p.classList.remove('active'));
    pill.classList.add('active');
    const sec = document.getElementById('sec-'+pill.dataset.section);
    if(sec) sec.scrollIntoView({behavior:'smooth', block:'start'});
    // on mobile switch to questions pane
    if(window.innerWidth<=768) switchPane('questions');
  });
});

// Mobile pane toggle
document.querySelectorAll('.pane-tab').forEach(tab=>{
  tab.addEventListener('click', ()=> switchPane(tab.dataset.pane));
});
function switchPane(pane){
  document.querySelectorAll('.pane-tab').forEach(t=>t.classList.remove('active'));
  document.querySelector(`.pane-tab[data-pane="${pane}"]`).classList.add('active');
  if(pane==='passage'){
    document.getElementById('paneLeft').style.display='block';
    document.getElementById('paneRight').style.display='none';
    document.getElementById('paneLeft').style.maxHeight='none';
  } else {
    document.getElementById('paneLeft').style.display='none';
    document.getElementById('paneRight').style.display='block';
    document.getElementById('paneRight').style.maxHeight='none';
  }
}

// ============ RESIZABLE DIVIDER ============
(function(){
  const divider = document.getElementById('divider');
  let isDragging = false;
  divider.addEventListener('mousedown', ()=>{isDragging=true; divider.classList.add('active');});
  document.addEventListener('mousemove', e=>{
    if(!isDragging) return;
    const container = document.querySelector('.test-body');
    const rect = container.getBoundingClientRect();
    const pct = ((e.clientX - rect.left) / rect.width) * 100;
    if(pct > 20 && pct < 80){
      document.getElementById('paneLeft').style.flex='0 0 '+pct+'%';
      document.getElementById('paneRight').style.flex='0 0 '+(100-pct)+'%';
    }
  });
  document.addEventListener('mouseup', ()=>{isDragging=false; divider.classList.remove('active');});
})();

// ============ HIGHLIGHTING SYSTEM ============
(function(){
  const passage = document.getElementById('passageText');

  // Prevent context menu on passage for mobile
  passage.addEventListener('contextmenu', e => e.preventDefault());

  // Double-tap / double-click to highlight word
  let lastTap = 0;
  passage.addEventListener('touchend', e => {
    const now = Date.now();
    if(now - lastTap < 350){
      e.preventDefault();
      highlightSelection();
    }
    lastTap = now;
  });

  passage.addEventListener('dblclick', e => {
    e.preventDefault();
    e.stopPropagation();
    setTimeout(highlightSelection, 10);
  });

  // For longer selections - on mouseup / touchend after selection
  passage.addEventListener('mouseup', e => {
    // Only if not double-click
    setTimeout(()=>{
      const sel = window.getSelection();
      if(sel && sel.toString().trim().length > 1 && sel.rangeCount){
        // Check if selection is inside passage
        if(passage.contains(sel.anchorNode)){
          showHighlightBubble(sel);
        }
      }
    }, 200);
  });

  // Touch-based longer selection
  let touchTimer;
  passage.addEventListener('touchstart', e => {
    clearTimeout(touchTimer);
  });
  passage.addEventListener('touchend', e => {
    setTimeout(()=>{
      const sel = window.getSelection();
      if(sel && sel.toString().trim().length > 3 && sel.rangeCount){
        if(passage.contains(sel.anchorNode)){
          highlightSelection();
        }
      }
    }, 100);
  });

  function highlightSelection(){
    const sel = window.getSelection();
    if(!sel || !sel.rangeCount || sel.toString().trim().length === 0) return;

    const range = sel.getRangeAt(0);
    // Check if already highlighted
    const parent = range.commonAncestorContainer.parentElement;
    if(parent && parent.classList && parent.classList.contains('user-highlight')){
      // Remove highlight
      const text = document.createTextNode(parent.textContent);
      parent.parentNode.replaceChild(text, parent);
      sel.removeAllRanges();
      showToast('Highlight removed','info');
      return;
    }

    try {
      const span = document.createElement('span');
      span.className = 'user-highlight';
      range.surroundContents(span);
      sel.removeAllRanges();
      showToast('Text highlighted','info');
    } catch(err){
      // Complex selections
      const fragment = range.extractContents();
      const span = document.createElement('span');
      span.className = 'user-highlight';
      span.appendChild(fragment);
      range.insertNode(span);
      sel.removeAllRanges();
      showToast('Text highlighted','info');
    }
  }

  function showHighlightBubble(sel){
    // Auto highlight on significant selections
  }

  // Prevent search popup on mobile
  document.addEventListener('selectionchange', ()=>{
    // We can't fully stop native behavior but we handle highlighting ourselves
  });
})();

// Stop touchstart from triggering search on mobile
document.getElementById('passageText').addEventListener('touchstart', e => {
  // Allow touch but prevent hold-to-search by using user-select management
}, {passive:true});

// ============ TOASTS ============
function showToast(msg, type='info'){
  const c = document.getElementById('toastContainer');
  const t = document.createElement('div');
  t.className = 'toast toast-'+type;
  t.textContent = msg;
  c.appendChild(t);
  setTimeout(()=>{ if(t.parentNode) t.remove(); }, 2800);
}

// ============ SUBMIT ============
function confirmSubmit(){
  const done = Object.keys(answers).length;
  const unanswered = 20 - done;
  document.getElementById('confirmMsg').textContent = unanswered > 0
    ? `You have ${unanswered} unanswered question(s). Submit anyway?`
    : 'All questions answered. Ready to submit?';
  document.getElementById('confirmOverlay').classList.add('active');
}
function closeConfirm(){ document.getElementById('confirmOverlay').classList.remove('active'); }

function doSubmit(){
  closeConfirm();
  testSubmitted = true;
  document.getElementById('submitOverlay').classList.add('active');
  // Exit fullscreen
  if(document.exitFullscreen) document.exitFullscreen().catch(()=>{});
  else if(document.webkitExitFullscreen) document.webkitExitFullscreen();
  showToast('Test submitted successfully!','success');
}

// ============ COPY ANSWERS ============
function copyAnswers(){
  let text = `READING TEST ‚Äî ANSWER SHEET\n`;
  text += `Student: ${studentNameVal}\n`;
  text += `Date: ${new Date().toLocaleDateString()}\n`;
  text += `Test Owner: DJAXONGIR TURAYEV\n`;
  text += `${'‚îÄ'.repeat(36)}\n\n`;

  text += `QUESTIONS 1‚Äì10 (Multiple Choice)\n`;
  for(let i=1;i<=10;i++) text += `  ${i}. ${answers[i]||'‚Äî'}\n`;
  text += `\nQUESTIONS 11‚Äì16 (True/False/Not Given)\n`;
  for(let i=11;i<=16;i++) text += `  ${i}. ${answers[i]||'‚Äî'}\n`;
  text += `\nQUESTIONS 17‚Äì20 (Vocabulary)\n`;
  for(let i=17;i<=20;i++) text += `  ${i}. ${answers[i]||'‚Äî'}\n`;

  text += `\n${'‚îÄ'.repeat(36)}\n`;
  text += `Total Answered: ${Object.keys(answers).length}/20\n`;

  if(navigator.clipboard && navigator.clipboard.writeText){
    navigator.clipboard.writeText(text).then(()=> showToast('Answers copied to clipboard!','success')).catch(()=>fallbackCopy(text));
  } else {
    fallbackCopy(text);
  }
}
function fallbackCopy(text){
  const ta = document.createElement('textarea');
  ta.value = text;
  ta.style.cssText='position:fixed;left:-9999px;';
  document.body.appendChild(ta);
  ta.select();
  ta.setSelectionRange(0, 99999);
  document.execCommand('copy');
  document.body.removeChild(ta);
  showToast('Answers copied!','success');
}

// ============ SAVE AS PDF ============
function savePDF(){
  // Build a clean printable page and trigger print-to-PDF
  const w = window.open('','_blank');
  if(!w){ showToast('Please allow popups to save PDF','error'); return; }
  let html = `<!DOCTYPE html><html><head><meta charset="UTF-8"><title>Answer Sheet - ${studentNameVal}</title>
  <style>
    body{font-family:Arial,sans-serif;padding:40px;color:#222;line-height:1.7;}
    h1{font-size:22px;border-bottom:3px solid #f0a500;padding-bottom:8px;margin-bottom:4px;}
    .meta{color:#555;font-size:13px;margin-bottom:24px;}
    .meta span{display:block;}
    h2{font-size:16px;background:#f0a500;color:#fff;display:inline-block;padding:4px 14px;border-radius:4px;margin:20px 0 10px;}
    table{width:100%;border-collapse:collapse;margin-bottom:20px;}
    td,th{border:1px solid #ddd;padding:10px 14px;text-align:left;font-size:14px;}
    th{background:#f8f8f8;font-weight:600;width:100px;}
    .footer{margin-top:30px;padding-top:14px;border-top:2px solid #eee;font-size:12px;color:#888;}
    @media print{body{padding:20px;}}
  </style></head><body>
  <h1>Reading Test ‚Äî Answer Sheet</h1>
  <div class="meta">
    <span><strong>Student:</strong> ${studentNameVal}</span>
    <span><strong>Date:</strong> ${new Date().toLocaleString()}</span>
    <span><strong>Test Owner:</strong> DJAXONGIR TURAYEV</span>
  </div>
  <h2>Questions 1‚Äì10 ¬∑ Multiple Choice</h2>
  <table>`;
  for(let i=1;i<=10;i++){
    const q = MCQ[i-1];
    html+=`<tr><th>Q${i}</th><td>${answers[i]||'‚Äî'}</td><td style="color:#666;font-size:13px;">${q.q}</td></tr>`;
  }
  html+=`</table><h2>Questions 11‚Äì16 ¬∑ True / False / Not Given</h2><table>`;
  for(let i=11;i<=16;i++){
    const q = TFNG[i-11];
    html+=`<tr><th>Q${i}</th><td>${answers[i]||'‚Äî'}</td><td style="color:#666;font-size:13px;">${q.q}</td></tr>`;
  }
  html+=`</table><h2>Questions 17‚Äì20 ¬∑ Vocabulary</h2><table>`;
  for(let i=17;i<=20;i++){
    const q = VOCAB[i-17];
    html+=`<tr><th>Q${i}</th><td>${answers[i]||'‚Äî'}</td><td style="color:#666;font-size:13px;"><strong>${q.word}</strong> ‚Äî ${q.para}</td></tr>`;
  }
  html+=`</table>
  <div class="footer">
    <strong>Total Answered:</strong> ${Object.keys(answers).length}/20<br>
    <em>Generated automatically by CD Reading Test System</em>
  </div>
  <script>window.onload=function(){window.print();}<\/script>
  </body></html>`;
  w.document.write(html);
  w.document.close();
  showToast('PDF ready ‚Äî use Print > Save as PDF','info');
}
</script>
</body>
</html>