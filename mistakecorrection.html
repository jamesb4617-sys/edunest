<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EDUNEST Grammar Correction Test</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }

        .welcome-screen {
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            padding: 20px;
        }

        .welcome-card {
            background: white;
            border: 3px solid #e53e3e;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 100%;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            text-align: center;
        }

        .brand-title {
            color: #e53e3e;
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-transform: uppercase;
        }

        .welcome-subtitle {
            color: #333;
            font-size: 1.3em;
            margin-bottom: 30px;
        }

        .input-group {
            margin-bottom: 25px;
        }

        .input-group label {
            display: block;
            text-align: left;
            margin-bottom: 8px;
            color: #555;
            font-weight: bold;
        }

        .input-group input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e53e3e;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.3s;
        }

        .input-group input:focus {
            outline: none;
            border-color: #c53030;
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
        }

        .start-button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 15px 40px;
            font-size: 1.2em;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-weight: bold;
            text-transform: uppercase;
        }

        .start-button:hover {
            background: #c53030;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.3);
        }

        .start-button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .test-container {
            display: none;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
        }

        .test-header {
            background: white;
            border: 3px solid #e53e3e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .test-header h1 {
            color: #e53e3e;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .student-info {
            color: #555;
            font-size: 1.1em;
            margin-top: 10px;
        }

        .instruction-box {
            background: #fff5f5;
            border: 2px solid #e53e3e;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .instruction-box p {
            color: #333;
            font-size: 1.05em;
            line-height: 1.6;
        }

        .question-card {
            background: white;
            border: 2px solid #e53e3e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .question-number {
            color: #e53e3e;
            font-weight: bold;
            font-size: 1.1em;
            margin-bottom: 10px;
        }

        .original-sentence {
            color: #333;
            font-size: 1.05em;
            margin-bottom: 15px;
            line-height: 1.8;
            padding: 12px;
            background: #f7fafc;
            border-left: 4px solid #e53e3e;
            border-radius: 4px;
        }

        .correction-label {
            color: #555;
            font-weight: bold;
            margin-bottom: 8px;
            font-size: 0.95em;
        }

        .correction-input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e53e3e;
            border-radius: 8px;
            font-size: 1em;
            transition: all 0.3s;
            font-family: 'Arial', sans-serif;
        }

        .correction-input:focus {
            outline: none;
            border-color: #c53030;
            box-shadow: 0 0 0 3px rgba(229, 62, 62, 0.1);
        }

        .submit-button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 15px 50px;
            font-size: 1.2em;
            border-radius: 8px;
            cursor: pointer;
            display: block;
            margin: 30px auto;
            font-weight: bold;
            text-transform: uppercase;
            transition: all 0.3s;
        }

        .submit-button:hover {
            background: #c53030;
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.3);
        }

        .results-container {
            display: none;
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            min-height: 100vh;
        }

        .results-header {
            background: white;
            border: 3px solid #e53e3e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: center;
        }

        .results-header h2 {
            color: #e53e3e;
            font-size: 2em;
            margin-bottom: 10px;
        }

        .answer-sheet {
            background: white;
            border: 2px solid #e53e3e;
            border-radius: 10px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .answer-item {
            padding: 15px;
            border-bottom: 1px solid #e2e8f0;
            margin-bottom: 15px;
        }

        .answer-item:last-child {
            border-bottom: none;
        }

        .answer-number {
            font-weight: bold;
            color: #e53e3e;
            font-size: 1.1em;
            margin-bottom: 8px;
        }

        .answer-original {
            color: #666;
            font-size: 0.95em;
            margin-bottom: 8px;
            font-style: italic;
        }

        .answer-correction {
            color: #333;
            font-size: 1em;
            padding: 10px;
            background: #f7fafc;
            border-left: 3px solid #e53e3e;
            border-radius: 4px;
        }

        .action-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .action-button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }

        .action-button:hover {
            background: #c53030;
            transform: translateY(-2px);
        }

        .action-button.secondary {
            background: #4a5568;
        }

        .action-button.secondary:hover {
            background: #2d3748;
        }

        .proctor-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: black;
            z-index: 10000;
            justify-content: center;
            align-items: center;
        }

        .proctor-modal {
            background: white;
            border: 3px solid #e53e3e;
            border-radius: 15px;
            padding: 40px;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .proctor-modal h3 {
            color: #e53e3e;
            font-size: 1.8em;
            margin-bottom: 15px;
        }

        .proctor-modal p {
            color: #555;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .proctor-modal input {
            width: 100%;
            padding: 12px;
            border: 2px solid #e53e3e;
            border-radius: 8px;
            font-size: 16px;
            margin-bottom: 15px;
        }

        .proctor-modal button {
            background: #e53e3e;
            color: white;
            border: none;
            padding: 12px 30px;
            font-size: 1.1em;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
        }

        .proctor-modal button:hover {
            background: #c53030;
        }

        .error-message {
            color: #e53e3e;
            margin-top: 10px;
            font-size: 0.9em;
        }

        @media (max-width: 768px) {
            .brand-title {
                font-size: 2em;
            }

            .welcome-card {
                padding: 30px 20px;
            }

            .test-header h1 {
                font-size: 1.5em;
            }

            .question-card {
                padding: 15px;
            }

            .submit-button {
                padding: 12px 30px;
                font-size: 1em;
            }

            .action-buttons {
                flex-direction: column;
            }

            .action-button {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .brand-title {
                font-size: 1.6em;
            }

            .welcome-subtitle {
                font-size: 1.1em;
            }

            .test-container,
            .results-container {
                padding: 10px;
            }
        }
    </style>
</head>
<body>
    <!-- Welcome Screen -->
    <div class="welcome-screen" id="welcomeScreen">
        <div class="welcome-card">
            <h1 class="brand-title">EDUNEST</h1>
            <h2 class="welcome-subtitle">Grammar Correction Test</h2>
            <div class="input-group">
                <label for="studentName">Enter Your Name:</label>
                <input type="text" id="studentName" placeholder="Your full name" autocomplete="off">
            </div>
            <div class="input-group">
                <label for="studentPassword">Enter Password:</label>
                <input type="password" id="studentPassword" placeholder="Enter password" autocomplete="off">
            </div>
            <div class="error-message" id="welcomeError"></div>
            <button class="start-button" id="startButton" disabled>Start Test</button>
        </div>
    </div>

    <!-- Test Container -->
    <div class="test-container" id="testContainer">
        <div class="test-header">
            <h1>EDUNEST GRAMMAR CORRECTION TEST</h1>
            <p class="student-info">Student: <span id="studentNameDisplay"></span></p>
        </div>

        <div class="instruction-box">
            <p><strong>Read each sentence carefully and write the correct form in the box below.</strong></p>
        </div>

        <div id="questionsContainer"></div>

        <button class="submit-button" id="submitButton">Submit Test</button>
    </div>

    <!-- Results Container -->
    <div class="results-container" id="resultsContainer">
        <div class="results-header">
            <h2>EDUNEST - Answer Sheet</h2>
            <p class="student-info">Student: <span id="studentNameResults"></span></p>
        </div>

        <div class="answer-sheet" id="answerSheet"></div>

        <div class="action-buttons">
            <button class="action-button" id="copyAnswersButton">Copy Answers</button>
            <button class="action-button secondary" id="downloadPDFButton">Download PDF</button>
        </div>
    </div>

    <!-- Proctor Overlay -->
    <div class="proctor-overlay" id="proctorOverlay">
        <div class="proctor-modal">
            <h3>⚠️ Alert!</h3>
            <p>You have left the test window. Please enter the reactivation code to continue.</p>
            <input type="text" id="reactivationCode" placeholder="Enter code">
            <div class="error-message" id="errorMessage"></div>
            <button id="reactivateButton">Reactivate</button>
        </div>
    </div>

    <script>
        const sentences = [
            "She go to the gym every morning before work.",
            "If I will see him tomorrow, I will tell him the news.",
            "They was very happy to meet us at the airport.",
            "By next year, I finish my course in programming.",
            "He don't like eating vegetables.",
            "I am knowing the answer, but I'm not sure.",
            "We would have helped you if you ask us earlier.",
            "She said that she is feeling tired after the trip.",
            "I was worked here for five years before I moved.",
            "He usually walk to school, but yesterday he walkded.",
            "If I had money, I will buy a new car.",
            "My brother can sings very well.",
            "The train has left when we arrived at the station.",
            "She doesn't know where is the library.",
            "I wish I can speak French fluently.",
            "While I was cooking, the phone ringed.",
            "He never goes to the park every Sunday.",
            "He asked me if I am coming to the party next week.",
            "If it rains, we stayed at home yesterday.",
            "I have never saw such a beautiful sunset before."
        ];

        let studentName = '';
        let answers = {};
        let testActive = false;

        const welcomeScreen = document.getElementById('welcomeScreen');
        const studentNameInput = document.getElementById('studentName');
        const studentPasswordInput = document.getElementById('studentPassword');
        const welcomeError = document.getElementById('welcomeError');
        const startButton = document.getElementById('startButton');
        const testContainer = document.getElementById('testContainer');
        const questionsContainer = document.getElementById('questionsContainer');
        const studentNameDisplay = document.getElementById('studentNameDisplay');
        const submitButton = document.getElementById('submitButton');
        const resultsContainer = document.getElementById('resultsContainer');
        const studentNameResults = document.getElementById('studentNameResults');
        const answerSheet = document.getElementById('answerSheet');
        const proctorOverlay = document.getElementById('proctorOverlay');
        const reactivationCode = document.getElementById('reactivationCode');
        const reactivateButton = document.getElementById('reactivateButton');
        const errorMessage = document.getElementById('errorMessage');
        const copyAnswersButton = document.getElementById('copyAnswersButton');
        const downloadPDFButton = document.getElementById('downloadPDFButton');

        function checkWelcomeForm() {
            const nameValid = studentNameInput.value.trim() !== '';
            const passwordValid = studentPasswordInput.value.trim() !== '';
            startButton.disabled = !(nameValid && passwordValid);
            welcomeError.textContent = '';
        }

        studentNameInput.addEventListener('input', checkWelcomeForm);
        studentPasswordInput.addEventListener('input', checkWelcomeForm);

        studentPasswordInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter' && !startButton.disabled) {
                startButton.click();
            }
        });

        startButton.addEventListener('click', () => {
            const enteredPassword = studentPasswordInput.value.trim();
            
            if (enteredPassword !== '2020') {
                welcomeError.textContent = 'Incorrect password. Please try again.';
                studentPasswordInput.value = '';
                studentPasswordInput.focus();
                return;
            }
            
            studentName = studentNameInput.value.trim();
            if (studentName) {
                welcomeScreen.style.display = 'none';
                testContainer.style.display = 'block';
                studentNameDisplay.textContent = studentName;
                renderQuestions();
                enterFullscreen();
                testActive = true;
                setupProctoring();
            }
        });

        function renderQuestions() {
            questionsContainer.innerHTML = '';
            sentences.forEach((sentence, index) => {
                const questionNum = index + 1;
                const questionCard = document.createElement('div');
                questionCard.className = 'question-card';
                
                const questionNumber = document.createElement('div');
                questionNumber.className = 'question-number';
                questionNumber.textContent = `${questionNum}.`;
                
                const originalSentence = document.createElement('div');
                originalSentence.className = 'original-sentence';
                originalSentence.textContent = sentence;
                
                const correctionLabel = document.createElement('div');
                correctionLabel.className = 'correction-label';
                correctionLabel.textContent = 'Write the correct sentence:';
                
                const correctionInput = document.createElement('input');
                correctionInput.type = 'text';
                correctionInput.className = 'correction-input';
                correctionInput.id = `answer${questionNum}`;
                correctionInput.placeholder = 'Type your corrected sentence here...';
                correctionInput.addEventListener('input', (e) => {
                    answers[questionNum] = e.target.value.trim();
                });
                
                questionCard.appendChild(questionNumber);
                questionCard.appendChild(originalSentence);
                questionCard.appendChild(correctionLabel);
                questionCard.appendChild(correctionInput);
                questionsContainer.appendChild(questionCard);
            });
        }

        submitButton.addEventListener('click', () => {
            // Collect any remaining values
            sentences.forEach((_, index) => {
                const questionNum = index + 1;
                const input = document.getElementById(`answer${questionNum}`);
                if (input) {
                    answers[questionNum] = input.value.trim();
                }
            });
            
            testActive = false;
            testContainer.style.display = 'none';
            resultsContainer.style.display = 'block';
            studentNameResults.textContent = studentName;
            displayAnswers();
            exitFullscreen();
        });

        function displayAnswers() {
            answerSheet.innerHTML = '';
            sentences.forEach((sentence, index) => {
                const questionNum = index + 1;
                const answerItem = document.createElement('div');
                answerItem.className = 'answer-item';
                
                const answerNumber = document.createElement('div');
                answerNumber.className = 'answer-number';
                answerNumber.textContent = `Question ${questionNum}`;
                
                const answerOriginal = document.createElement('div');
                answerOriginal.className = 'answer-original';
                answerOriginal.textContent = `Original: ${sentence}`;
                
                const answerCorrection = document.createElement('div');
                answerCorrection.className = 'answer-correction';
                answerCorrection.textContent = `Your answer: ${answers[questionNum] || '(not answered)'}`;
                
                answerItem.appendChild(answerNumber);
                answerItem.appendChild(answerOriginal);
                answerItem.appendChild(answerCorrection);
                answerSheet.appendChild(answerItem);
            });
        }

        copyAnswersButton.addEventListener('click', () => {
            let text = `EDUNEST Grammar Correction Test - Answer Sheet\nStudent: ${studentName}\n\n`;
            sentences.forEach((sentence, index) => {
                const questionNum = index + 1;
                text += `${questionNum}. Original: ${sentence}\n`;
                text += `   Your answer: ${answers[questionNum] || '(not answered)'}\n\n`;
            });
            
            navigator.clipboard.writeText(text).then(() => {
                alert('Answers copied to clipboard!');
            });
        });

        downloadPDFButton.addEventListener('click', () => {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            doc.setFontSize(16);
            doc.setTextColor(229, 62, 62);
            doc.text('EDUNEST Grammar Correction Test', 105, 15, { align: 'center' });
            
            doc.setFontSize(12);
            doc.setTextColor(0, 0, 0);
            doc.text(`Student: ${studentName}`, 20, 30);
            
            doc.setFontSize(9);
            let yPos = 45;
            
            sentences.forEach((sentence, index) => {
                const questionNum = index + 1;
                
                if (yPos > 260) {
                    doc.addPage();
                    yPos = 20;
                }
                
                doc.setTextColor(229, 62, 62);
                doc.text(`${questionNum}.`, 20, yPos);
                yPos += 5;
                
                doc.setTextColor(100, 100, 100);
                const originalLines = doc.splitTextToSize(`Original: ${sentence}`, 170);
                doc.text(originalLines, 20, yPos);
                yPos += (originalLines.length * 5);
                
                doc.setTextColor(0, 0, 0);
                const answerLines = doc.splitTextToSize(`Answer: ${answers[questionNum] || '(not answered)'}`, 170);
                doc.text(answerLines, 20, yPos);
                yPos += (answerLines.length * 5) + 5;
            });
            
            doc.save(`${studentName}_EDUNEST_Grammar_Test.pdf`);
        });

        function enterFullscreen() {
            const elem = document.documentElement;
            if (elem.requestFullscreen) {
                elem.requestFullscreen();
            } else if (elem.webkitRequestFullscreen) {
                elem.webkitRequestFullscreen();
            } else if (elem.msRequestFullscreen) {
                elem.msRequestFullscreen();
            }
        }

        function exitFullscreen() {
            if (document.exitFullscreen) {
                document.exitFullscreen();
            } else if (document.webkitExitFullscreen) {
                document.webkitExitFullscreen();
            } else if (document.msExitFullscreen) {
                document.msExitFullscreen();
            }
        }

        function setupProctoring() {
            window.addEventListener('blur', handleProctorViolation);
            document.addEventListener('fullscreenchange', handleFullscreenChange);
            document.addEventListener('webkitfullscreenchange', handleFullscreenChange);
            document.addEventListener('msfullscreenchange', handleFullscreenChange);
            document.addEventListener('visibilitychange', handleVisibilityChange);
        }

        function handleProctorViolation() {
            if (testActive) {
                showProctorOverlay();
            }
        }

        function handleFullscreenChange() {
            if (testActive && !document.fullscreenElement && !document.webkitFullscreenElement && !document.msFullscreenElement) {
                showProctorOverlay();
            }
        }

        function handleVisibilityChange() {
            if (testActive && document.hidden) {
                showProctorOverlay();
            }
        }

        function showProctorOverlay() {
            proctorOverlay.style.display = 'flex';
            reactivationCode.value = '';
            errorMessage.textContent = '';
        }

        function hideProctorOverlay() {
            proctorOverlay.style.display = 'none';
            enterFullscreen();
        }

        reactivateButton.addEventListener('click', () => {
            if (reactivationCode.value === '9240') {
                hideProctorOverlay();
            } else {
                errorMessage.textContent = 'Incorrect code. Please try again.';
            }
        });

        reactivationCode.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                reactivateButton.click();
            }
        });

        document.addEventListener('contextmenu', (e) => {
            if (testActive) {
                e.preventDefault();
            }
        });
    </script>
</body>
</html>